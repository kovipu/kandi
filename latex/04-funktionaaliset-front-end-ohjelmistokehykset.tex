\chapter{Funktionaaliset front-end ohjelmistokehykset}
Tämän tutkielman tutkimuskohteiksi on valittu funktionaaliset reaktiiviset ohjelmistokehykset React-kirjasto ja
Elm-ohjelmointikieli. React-kirjastoa ja Elm-kieltä tutkitaan yleisesti funktionaalisen ohjelmoinnin kannalta, sekä
tarkemmin siitä, miten ne toteuttavat tilankäsittelyn, mahdollistavatko ne sivuvaikutukset ja miten toteuttavat
asynkroniset tapahtumat.

\section{Ohjelmistokehysten esittely}
React on Facebookin ylläpitämä avoimen lähdekoodin käyttöliittymäkirjasto, jota käytetään tyypillisesti
JavaScript-kielen kanssa. React on alunperin julkaistu vuonna 2013 ja se on kirjoitushetkellä vuonna 2020 maailman
suosituin front-end ohjelmistokehys noin yhdeksällä miljoonalla viikoittaisella latauksella NPM-palvelusta 
\cite{npmtrends}. React-kirjaston syntaksi on deklaratiivista, ja se mahdollistaa käyttöliittymän pilkkomisen
komponentteihin. React ei ota kantaa muihin tekniikkaratkaisuihin, vaan keskittyy pelkästään yksittäisen DOM-puun
hallitsemiseen. Ohjelmistokehittäjälle jää näin täysi valta valita muut teknologiat vapaasti. \cite{reactjs}

Elm on funktionaalinen ohjelmointikieli, joka käännetään JavaScript-kieleksi. Elmin on alunperin kehittänyt Evan
Czaplicki osana maisterin tutkielmaansa (eng. Master's thesis) vuonna 2012. Elm ei ole tutkielman kirjoitushetkellä
saavuttanut suurta suosiota, vaan sen NPM-paketinhallinnan latausmäärä on vain noin kolmekymmentä tuhatta latausta
viikossa \cite{npmtrends}. Elm keskittyy web-pohjaisten graafisten käyttöliittymien deklaratiiviseen toteuttamiseen. Elm
kytkeytyy tavallisen HTML DOM-puun solmuun. Elm ei myöskään ota kantaa muihin tekniikkaratkaisuihin, kuten tyylikieleen,
mutta Elm-koodissa on hyvin vaikeaa käyttää muilla kielillä kirjoitettuja komponentteja ja kirjastoja. \cite{elmlang}

\section{Funktionaalinen ohjelmointi}
React korostaa funktionaalista ohjelmointia yli imperatiivisen ohjelmoinnin, mutta sallii silti kaiken tavallisen
imperatiivisen JavaScript-syntaksin. React ei pystykään välttämään muuttuvia arvoja tai sivuvaikutuksia, mutta rohkaisee
silti ohjelmoimaan funktionaalisesti, muun muassa tarjoamalla tilanhallinan, joka soveltuu funktionaaliseen
ohjelmointiin. \cite{reactjs}

Elm pyrkii olemaan puhtaasti funktionaalinen ohjelmointikieli, eikä salli lainkaan esimerkiksi muuttuvia arvoja tai
epäpuhtaita funktioita. Elm ei myöskään salli tilanteita, jotka voisivat aiheuttaa ajonaikaisia virheitä, vaan pakottaa
virheiden käsittelyn funktionaalisesti datana. Elm-kielen ajonaikanen ohjelmistokehys abstraktoi näennäisesti kaikki
epäpuhtaudet sisällensä, joten Elm-kielellä toteutettu ohjelma on näennäisesti puhtaan funktionaalinen. \cite{elmlang}

\section{Funktionaalinen tilankäsittely}
React tukee lokaalia tilaa missä tahansa komponentissa, joka on ristiriidassa funktionaalisen paradigman kanssa. Tila
React-kirjastossa on kuitenkin muuttumaton datarakenne, jonka muuttaminen vaatii sen korvaamisen uudella datalla. Tilan
muokkaamiseen on perinteisesti käytetty React-kirjaston Component-luokan setState-metodia, joka ylikirjoittaa tilan.
\begin{minted}{js}
// väärin
this.state.greeting = 'Moikku';
// oikein
this.setState({ greeting: 'Moikku' });
\end{minted}
React-kirjasto tukee nykyään vakiona myös epäpuhtauksia funktioiksi abstraktoivia koukkuja (eng. hooks). Koukut
mahdollistavat esimerkiksi tilankäsittelyn puhtaassa funktionaalisessa komponentissa, ilman että tarvitaan luokkaa.
\begin{minted}{jsx}
const Example = () => {
  // greeting on tila, joka muuttuu reaktiivisesti
  // setGreeting on funktio, jonka kutsuminen muuttaa tilan
  const [greeting, setGreeting] = useState('Moikku');
  return (
    <h1>{greeting}</h1>
  );
}
\end{minted}

Funktionaalisen React-sovelluksen toteutukseen on tyypillistä käyttää funktionaaliselle ohjelmalle tyypillistä
tilamallia, jossa koko sovelluksen tilaa kuvataan yhdessä paikassa. Tämänkaltainen tilanhallinta yksinkertaistaa
ymmärtämään tilan muutosten vaikutusta sovellukseen. Tyypillinen tapa toteuttaa keskitetty tilanhallinta
funktionaalisesti on reducer-funktion avulla, joka palauttaa uuden tilan aiemman tilan ja tapahtuman perusteella.
Modernissa React-kirjastossa tämänkaltaista tilanhallintaa voidaan käyttää useReducer-koukun avulla. Vastaavan
toteutuksen tarjoaa myös kolmannen osapuolien toteutuksista suosituimpiin kuuluva Redux-kirjasto
\cite{functionalwebdev}. Yksinkertaisiin sovelluksiin on silti riittävää käyttää lyhyemmän syntaksin natiiveja
vaihtoehtoja, kuten perinteinen setState-toteutus ja useState-koukku. \cite{reactjs}

Elm-kielen arkkitehtuurissa tila on Model-nimisessä abstraktoidussa datamallissa. Model-tilan kuvaaminen ja
päivittäminen on hyvin samankaltaista, kuin React-kirjaston Redux-tilanhallinta. Redux on ottanutkin inspiraatiota
Elm-kielen Model-tilanhallinnasta. Model-tilan muokkaaminen tapahtuu kutsumalla update-funktiota message-parametrilla,
samankaltaisesti, kuin Redux-kirjaston reducer-funktiossa. \cite{elmlang}
\begin{minted}{elm}
-- MODEL
type alias Model = Int

init : Model
init =
  0

-- UPDATE
type MSG = Increment | Decrement

update : Msg -> Model -> Model
update msg model =
  case msg of
    Increment ->
      model + 1
    Decrement ->
      model - 1
\end{minted}

Sekä React-kirjaston, että Elm-kielen tilanhallinta on hyvin tyypillistä funktionaalista ohjelmointia. Kumpikaan
ohjelmistokehys ei suosittele muuttuvaa tilaa, vaan tilaa säilötään muuttumattomassa tietorakenteessa. React-kirjastossa
yksittäisellä komponentilla voi olla lokaali tila, joka ei ole Elm-kielessä mahdollista, vaan kaikki tila on
keskitetysti Model-rakenteessa.

\section{Sivuvaikutukset}

% Selitä sivuvaikutus auki
// Reactissa: imperatiivinen ohjelmointi, useEffect

// Elmissä: Elm-runtime abstraktoi, innokas laskenta aiheuttaa sivuvaikutuksia

\section{Funktionaalinen tapahtumankäsittely}

// eventit, api-kutsut \& asynkronisuus
